{
    "contents" : "\n#=============================================================================#\n# Extract posteriors from the STAN MCMC\n#=============================================================================#\ntrace <- extract(fit_CM)\nnames(trace)\npost_in <- data.frame(dC1 = trace$dC1, dC2 = trace$dC2,dC3 = trace$dC3,dN = trace$dN, dH = trace$dH,\n                      Delta_C = trace$Delta_C, Delta_N = trace$Delta_N, Delta_H = trace$Delta_H,frac_H_blki = trace$fblki,\n                      omega = trace$omega, tau = trace$tau, phi = trace$phi, sigma_fblki = trace$sigma_fblki,\n                      sigma_frc = trace$sigma_frc, sigma_frcH = trace$sigma_frcH,\n                      sigma_src = trace$sigma_src,\n                      lp = trace$lp__)\npost <- melt(data.frame(Sample = 1:nrow(post_in), post_in), id.vars = \"Sample\")\nhead(post_in)\nnames(post_in)\npost$Source <- NA\npost$Species <- NA\nfor (i in 1:J)\n{\n    post$Source[post$variable %in%  paste0(\"phi.\",i,\".1\")] <- \"Offshore\"\n    post$Source[post$variable %in%  paste0(\"phi.\",i,\".2\")] <- \"Coastal\"\n    post$Source[post$variable %in%  paste0(\"phi.\",i,\".3\")] <- \"Freshwater\"\n    post$Species[post$variable %in% paste0(\"phi.\",i,\".1\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n    post$Species[post$variable %in% paste0(\"phi.\",i,\".2\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n    post$Species[post$variable %in% paste0(\"phi.\",i,\".3\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n    post$Species[post$variable %in% paste0(\"omega.\",i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n    post$Species[post$variable %in% paste0(\"tau.\",i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n    post$Species[post$variable %in% paste0(\"sigma_frc.1.\",i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n    post$Species[post$variable %in% paste0(\"sigma_frc.2.\",i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n}\n\n# posteriors for dC_exp, dN_exp, and dH_exp\nm <- as.matrix(fit_CM)\nhead(m)\ngpost <- NULL\nfor (j in 1:J)\n{\n  block <- data.frame(levels(factor(dat$Species, ordered = TRUE))[j],\n                      m[ , grep(\"dC_exp\", colnames(m))[j]],\n                      m[ , grep(\"dN_exp\", colnames(m))[j]],\n                      m[ , grep(\"dH_exp\", colnames(m))[j]],\n                      m[ , grep(\"sigma_C\", colnames(m))[j]],\n                      m[ , grep(\"sigma_N\", colnames(m))[j]],\n                      m[ , grep(\"sigma_H\", colnames(m))[j]])\n  gpost <- rbind(gpost, block)\n}\ngpost <- data.frame(gpost)\nnames(gpost) <- c(\"Species\",\"dC\",\"dN\",\"dH\", \"sigma_C\", \"sigma_N\", \"sigma_H\")\ngpost$sp1 <- as.numeric(gpost$Species)\n\n# posterior predictive distribution\nlibrary(plyr)\ngroups <- count(factor(grp))\ngroup_sample <- matrix(groups[1:J, 2])\n\ngpostpd_C <- data.frame(matrix(NA, nrow = max(group_sample), ncol = J))\nnames(gpostpd_C) <- c(levels(dat$Species))\ngpostpd_N <- data.frame(matrix(NA, nrow = max(group_sample), ncol = J))\nnames(gpostpd_N) <- c(levels(dat$Species))\ngpostpd_H <- data.frame(matrix(NA, nrow = max(group_sample), ncol = J))\nnames(gpostpd_H) <- c(levels(dat$Species))\n\nfor (i in 1:J) {\n  gpostpd_C[1:group_sample[i], i] <- rnorm(group_sample[i], gpost$dC[gpost$sp1 == i], gpost$sigma_C[gpost$sp1 == i])\n  gpostpd_N[1:group_sample[i], i] <- rnorm(group_sample[i], gpost$dN[gpost$sp1 == i], gpost$sigma_N[gpost$sp1 == i])\n  gpostpd_H[1:group_sample[i], i] <- rnorm(group_sample[i], gpost$dH[gpost$sp1 == i], gpost$sigma_H[gpost$sp1 == i])\n}\n\npdC <- melt(gpostpd_C, na.rm = T)\npdN <- melt(gpostpd_N, na.rm = T)\npdH <- melt(gpostpd_H, na.rm = T)\n\npost_pred <- cbind(data.frame(Species = pdC[,1]), dC_ppd = pdC[,2], dN_ppd = pdN[,2], dH_ppd = pdH[,2])\n\n# fractionation corrected source posterior\nnames(trace)\npost2_in <- data.frame(srcC = trace$srcC, srcH = trace$srcH, srcN = trace$srcN)\npost2 <- melt(data.frame(Sample = 1:nrow(post2_in), post2_in), id.vars = \"Sample\")\nhead(post2_in)\npost2$Source <- NA\npost2$Species <- NA\nfor (i in 1:J)\n{\n  post2$Source[post2$variable %in%  paste0(\"srcC.\",i,\".1\")] <- \"Offshore\"\n  post2$Source[post2$variable %in%  paste0(\"srcC.\",i,\".2\")] <- \"Coastal\"\n  post2$Source[post2$variable %in%  paste0(\"srcC.\",i,\".3\")] <- \"Freshwater\"\n  post2$Species[post2$variable %in% paste0(\"srcC.\",i,\".1\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  post2$Species[post2$variable %in% paste0(\"srcC.\",i,\".2\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  post2$Species[post2$variable %in% paste0(\"srcC.\",i,\".3\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  post2$Source[post2$variable %in%  paste0(\"srcH.\",i,\".1\")] <- \"Offshore\"\n  post2$Source[post2$variable %in%  paste0(\"srcH.\",i,\".2\")] <- \"Coastal\"\n  post2$Source[post2$variable %in%  paste0(\"srcH.\",i,\".3\")] <- \"Freshwater\"\n  post2$Species[post2$variable %in% paste0(\"srcH.\",i,\".1\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  post2$Species[post2$variable %in% paste0(\"srcH.\",i,\".2\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  post2$Species[post2$variable %in% paste0(\"srcH.\",i,\".3\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  post2$Source[post2$variable %in%  paste0(\"srcN.\",i,\".1\")] <- \"Offshore\"\n  post2$Source[post2$variable %in%  paste0(\"srcN.\",i,\".2\")] <- \"Coastal\"\n  post2$Source[post2$variable %in%  paste0(\"srcN.\",i,\".3\")] <- \"Freshwater\"\n  post2$Species[post2$variable %in% paste0(\"srcN.\",i,\".1\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  post2$Species[post2$variable %in% paste0(\"srcN.\",i,\".2\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  post2$Species[post2$variable %in% paste0(\"srcN.\",i,\".3\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n}\n\ni <- grepl(\"srcC\", post2$variable)\nspost <- data.frame(cbind(Source = post2[i, 4], Species = post2[i, 5]))\nspost$dC <- post2[i, 3]\ni <- grepl(\"srcH\", post2$variable)\nspost$dH <- post2[i, 3]\ni <- grepl(\"srcN\", post2$variable)\nspost$dN <- post2[i, 3]\nspost$Source <- factor(spost$Source, levels = c(\"Offshore\",\"Coastal\",\"Freshwater\"))\nspost$Species <- factor(spost$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\n\n# Bayesian point estimate for dH_adj, which approximates the proportion of 2H_diet\n\npost3_in <- data.frame(dH_adj = trace$dH_adj)\npost3 <- melt(data.frame(Sample = 1:nrow(post3_in), post3_in), id.vars = \"Sample\")\nhead(post3)\ndH_adj_postmean <- as.vector(by(post3[, \"value\"], post3$variable, mean))\n\n#=============================================================================#\n# MCMC trace plots\n#=============================================================================#\n\ni <- grepl(\"phi\", post$variable)\nd1 <- post[i,]\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- ggplot(data = d1) + \n  facet_wrap(Species ~ Source, scales = \"free_y\", ncol = 6) + \n  geom_line(aes(Sample, value)) + \n  ylab(bquote(paste(\"Source Proportion\", ~phi))) + xlab (\"\\nSample\")\npng(\"figs/mcmc_par_trace_phi.png\", width = 10, height = 8, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\npost$Labs <- NA\npost$Labs[post$variable %in%  paste0(\"dC.\", 1)] <- \"Offshore Carbon\"\npost$Labs[post$variable %in%  paste0(\"dC.\", 2)] <- \"Coastal Carbon\"\npost$Labs[post$variable %in%  paste0(\"dC.\", 3)] <- \"Freshwater Carbon\"\npost$Labs[post$variable %in%  paste0(\"dH.\", 1)] <- \"Offshore Hydrogen\"\npost$Labs[post$variable %in%  paste0(\"dH.\", 2)] <- \"Coastal Hydrogen\"\npost$Labs[post$variable %in%  paste0(\"dH.\", 3)] <- \"Freshwater Hydrogen\"\npost$Labs[post$variable %in%  paste0(\"dN.\", 1)] <- \"Offshore Nitrogen\"\npost$Labs[post$variable %in%  paste0(\"dN.\", 2)] <- \"Coastal Nitrogen\"\npost$Labs[post$variable %in%  paste0(\"dN.\", 3)] <- \"Freshwater Nitrogen\"\npost$Labs[post$variable %in%  \"sigma_src.1.1\"] <- \"Sigma Offshore Carbon\"\npost$Labs[post$variable %in%  \"sigma_src.1.2\"] <- \"Sigma Coastal Carbon\"\npost$Labs[post$variable %in%  \"sigma_src.1.3\"] <- \"Sigma Freshwater Carbon\"\npost$Labs[post$variable %in%  \"sigma_src.2.1\"] <- \"Sigma Offshore Nitrogen\"\npost$Labs[post$variable %in%  \"sigma_src.2.2\"] <- \"Sigma Coastal Nitrogen\"\npost$Labs[post$variable %in%  \"sigma_src.2.3\"] <- \"Sigma Freshwater Nitrogen\"\npost$Labs[post$variable %in%  \"sigma_src.3.1\"] <- \"Sigma Offshore Hydrogen\"\npost$Labs[post$variable %in%  \"sigma_src.3.2\"] <- \"Sigma Coastal Hydrogen\"\npost$Labs[post$variable %in%  \"sigma_src.3.3\"] <- \"Sigma Freshwater Hydrogen\"\n\nfor (i in 1:J) {\npost$Labs[post$variable %in% paste0(\"tau.\",i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n}\n\nfor (i in 1:M) {\n#post$Labs[post$variable %in%  paste0(\"Delta_C.\",i)] <- levels(factor(dat$Taxa, ordered = TRUE))[i]\npost$Labs[post$variable %in%  paste0(\"Delta_N.\",i)] <- levels(factor(dat$Taxa, ordered = TRUE))[i]\n}\n\npost$Labs[post$variable %in%  \"Delta_C\"] <- \"Delta C\"\n\npost$Labs[post$variable %in%  \"Delta_H\"] <- \"Delta H\"\n\npost$Labs[post$variable %in%  \"fblki\"] <- \"f BLKI\"\n# post$Labs <- factor(post$Labs, levels = c(\"Offshore Carbon\",\"Coastal Carbon\", \"Freshwater Carbon\", \"Offshore Nitrogen\", \"Coastal Nitrogen\", \"Freshwater Nitrogen\" , \"Offshore Hydrogen\", \"Coastal Hydrogen\", \"Freshwater Hydrogen\",\n#                                          \"Sigma Offshore Carbon\",\"Sigma Coastal Carbon\", \"Sigma Freshwater Carbon\", \"Sigma Offshore Nitrogen\", \"Sigma Coastal Nitrogen\", \"Sigma Freshwater Nitrogen\" , \"Sigma Offshore Hydrogen\", \"Sigma Coastal Hydrogen\", \"Sigma Freshwater Hydrogen\", \"Delta C\", \"Delta N\", \"Delta H\", \"f BLKI\"))\n\ni <- grepl(\"dC\", post$variable) | grepl(\"dN\", post$variable) | grepl(\"dH\", post$variable) | grepl(\"sigma_src\", post$variable)\nd1 <- post[i,]\nhead(d1)\np <- ggplot(data = d1) +\n  facet_wrap(~Labs,  scales = \"free_y\", ncol = 3) +\n  geom_line(aes(Sample, value))\npng(\"figs/mcmc_par_trace_sources.png\", width = 8, height = 8, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"Delta\", post$variable) \nd1 <- post[i,]\nhead(d1)\np <- ggplot(data = d1) + facet_wrap(~variable,  scales = \"free_y\", ncol = 4) + geom_line(aes(Sample, value))\npng(\"figs/mcmc_par_trace_fractionation.png\", width = 8, height = 4, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"Delta_N\", post$variable) \nd1 <- post[i,]\nhead(d1)\np <- ggplot(data = d1) +\n  facet_wrap(~Labs,  scales = \"free_y\", ncol = 3) +\n  geom_line(aes(Sample, value)) + ylab(\"\\nDelta N\")\npng(\"figs/mcmc_par_trace_Nfractionation.png\", width = 6, height = 4, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\n\ni <- grepl(\"sigma_frc.1.\", post$variable)\nd1 <- post[i,]\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- ggplot(data = d1) +  geom_line(aes(x = Sample, y = value)) +\n  facet_wrap(~Species, scales = \"free_y\", ncol = 4) + ylab(expression(paste(sigma, \" Carbon Trophic Fractionation\"))) + xlab(\"\\nSample\")\npng(\"figs/mcmc_par_trace_sigma_C_frac.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"sigma_frc.2.\", post$variable)\nd1 <- post[i,]\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- ggplot(data = d1) +  geom_line(aes(x = Sample, y = value)) +\n  facet_wrap(~Species, scales = \"free_y\", ncol = 4) + ylab(bquote(paste(\"\\n\", sigma, \" Nitrogen Trophic Fractionation\"))) + xlab(\"\\nSample\")\npng(\"figs/mcmc_par_trace_sigma_N_frac.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"omega\", post$variable)\nd1 <- post[i,]\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- ggplot() + geom_line(data = d1, aes(x = Sample, y = value)) +  \n  facet_wrap(~Species, scales = \"free_y\", ncol = 4) + ylab(\"Omega\\n\") + xlab (\"\\nSample\")\npng(\"figs/mcmc_par_trace_omega.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\n#=============================================================================#\n# MCMC histograms\n#=============================================================================#\n# Find the range of each of the variables for plotting priors\nrng <- apply(post_in, 2, range)\n# Create a different data frame for plotting the priors\nxx <- apply(rng, 2, function(x) seq(x[1], x[2], length.out = 1000))\ndp <- xx\nhead(dp)\nblki_omega <- 1-(1-0.23)^(mean(xx[, \"tau.1\"])-1)\nkimu_omega <- 1-(1-0.23)^(mean(xx[, \"tau.8\"])-1)\nmamu_omega <- 1-(1-0.23)^(mean(xx[, \"tau.9\"])-1)\npri <- c(function(x){ dnorm(x, -24.2, 0.8) },      # dC.1 marine\n         function(x){ dnorm(x, -19.1, 1.2) },      # dC.2 coastal\n         function(x){ dnorm(x, -26.4, 1.47) },     # dC.3 freshwater\n         function(x){ dnorm(x, 3.6, 0.2) },        # dN.1 marine\n         function(x){ dnorm(x, 3.1, 0.6) },        # dN.2 coastal\n         function(x){ dnorm(x, 4.4, 3.9) },        # dN.3 freshwater\n         function(x){ dnorm(x, -7.4, 1.0) },       # dH.1 marine\n         function(x){ dnorm(x, -15.3, 3.6) },      # dH.2 coastal\n         function(x){ dnorm(x, -113.0, 10.9) },    # dH.3 freshwater\n         replicate(M, function(x){ dnorm(x, 0.4, 1.3) }),  # Delta_C\n         #function(x){ dnorm(x, 0.4, 1.3) },      # Delta_C\n         function(x){ dnorm(x, 3.0, 0.9) },      # Delta_N   \n         function(x){ dnorm(x, 2.2, 0.7) },      # Delta_N\n         function(x){ dnorm(x, 3.2, 1.9) },      # Delta_N\n         function(x){ dnorm(x, 2.3, 0.9) },      # Delta_N\n         function(x){ dnorm(x, 2.3, 0.9) },     # Delta_N\n         function(x){ dnorm(x, 2.2, 1.1) },      # Delta_N\n         function(x){ dnorm(x, -163.7, 27.0) },   # Delta_H\n         function(x){ dunif(x, 30, 150) },         # fblki\n         #function(x){ dnorm(x, blki_omega, 0.02) },# omega BLKI \n         function(x){ dunif(x, 0.18, 0.50) }, \n         function(x){ dnorm(x, 0.23, 0.03) },      # omega Bulk zoop\n         function(x){ dnorm(x, 0.33, 0.1) },       # omega capelin\n         function(x){ dnorm(x, 0.23, 0.03) },      # omega copepod\n         function(x){ dnorm(x, 0.23, 0.03) },      # omega epacifica\n         function(x){ dnorm(x, 0.33, 0.1) },       # omega eulachon\n         function(x){ dnorm(x, 0.33, 0.1) },       # omega herring\n         #function(x){ dnorm(x, kimu_omega, 0.02) },    # omega KIMU\n         #function(x){ dnorm(x, mamu_omega, 0.02) },   # omega MAMU\n         function(x){ dunif(x, 0.18, 0.50) }, \n         function(x){ dunif(x, 0.18, 0.50) }, \n         function(x){ dnorm(x, 0.23, 0.03) },  # omega neomysis\n         function(x){ dnorm(x, 0.33, 0.1) },   # omega pollock\n         function(x){ dnorm(x, 0.33, 0.1) },   # omega sandlance\n         function(x){ dnorm(x, 0.23, 0.03) },  # omega T libellula\n         function(x){ dnorm(x, 0.23, 0.03) },  # omega Thysanoessa\n         function(x){ dnorm(x, 0.33, 0.1) },   # omega YOY capelin\n         function(x){ dnorm(x, 0.33, 0.1) },   # omega YOY herring\n         function(x){ dnorm(x, 0.33, 0.1) },   # omega YOY pollock\n         replicate(J, function(x){NA}),                        # tau\n         replicate(3*J, function(x){ NA }),                    # phis\n         function(x){ dunif(x, 0.0, 10000)},                   # sigma_fblki\n         replicate(2*J, function(x){ dunif(x, 0.0, 10000) }),  # sigma_frc\n         function(x){ dunif(x, 0.0, 10000) },    # sigma_frcH\n         replicate(3*K, function(x){ dunif(x, 0.0, 10000) }),  # sigma_src\n         function(x){ NA }                                     # lp\n)\n\nfor (ii in 1:ncol(xx)) {\n    dp[,ii] <- pri[[ii]](xx[,ii])\n}\nxx <- melt(xx)\ndp <- melt(dp)\ndp$x <- xx$value\nnames(dp) <- c(\"Var1\",\"variable\",\"value1\",\"x\")\ndp$Species <- NA\ndp$Labs <- NA\nfor (i in 1:J)\n{\n  dp$Species[dp$variable %in% paste0(\"tau.\",i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  dp$Species[dp$variable %in% paste0(\"phi.\",i,\".1\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  dp$Species[dp$variable %in% paste0(\"phi.\",i,\".2\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  dp$Species[dp$variable %in% paste0(\"phi.\",i,\".3\")] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  dp$Species[dp$variable %in% paste0(\"omega.\",i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  dp$Species[dp$variable %in% paste0(\"sigma_frc.1.\",i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  dp$Species[dp$variable %in% paste0(\"sigma_frc.2.\",i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  dp$Species[dp$variable %in%  paste0(\"sigma_frc.1\", i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n  dp$Species[dp$variable %in%  paste0(\"sigma_frc.2\", i)] <- levels(factor(dat$Species, ordered = TRUE))[i]\n}\n\nfor (i in 1:3){\n  dp$Source[dp$variable %in%  paste0(\"sigma_src.\", i, \".1\")] <- \"Offshore\"\n  dp$Source[dp$variable %in%  paste0(\"sigma_src.\", i, \".2\")] <- \"Coastal\"\n  dp$Source[dp$variable %in%  paste0(\"sigma_src.\", i, \".3\")] <- \"Freshwater\"\n  dp$Isotope[dp$variable %in%  paste0(\"sigma_src.1.\", i)] <- \"Carbon\"\n  dp$Isotope[dp$variable %in%  paste0(\"sigma_src.2.\", i)] <- \"Nitrogen\"\n  dp$Isotope[dp$variable %in%  paste0(\"sigma_src.3.\", i)] <- \"Hydrogen\"\n}\n\ni <- grepl(\"phi\", post$variable)\nd1 <- post[i,]\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\nd1$Source <- factor(d1$Source, levels = c(\"Offshore\", \"Coastal\", \"Freshwater\"))\np <- ggplot(d1, aes(value)) +\n    #facet_wrap(Species ~ Source, scales = \"free\", ncol = 3) +\n    facet_grid(Species ~ Source, scales = \"free\") +\n    geom_histogram(aes(y = ..density..)) +  xlab(\"\\nSource Proportion\") + ylab(\"Probability Density\\n\") +\n    theme()\npng(\"figs/mcmc_par_hist_phi.png\", width = 8, height = 12, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"phi\", post$variable)\nd1 <- post[i,]\ncpal <- c(\"#999999\", \"#E69F00\", \"#56B4E9\")\nd1$Source <- factor(d1$Source, levels = c(\"Offshore\",\"Coastal\",\"Freshwater\"))\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- ggplot(d1, aes(x = value)) + facet_wrap(~Species, scales = \"free_y\", ncol = 6) +\n    geom_density(aes(fill = Source), alpha = 0.5) +  xlab(\"\\nProportion of the diet\") + ylab(\"Probability density\\n\") + \n    scale_fill_manual(values = cpal) + theme(legend.position = c(1,0), legend.justification = c(1,0))\n\npng(\"figs/mcmc_par_density_phis.png\", width = 10, height = 5, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"dC\", post$variable) | grepl(\"dN\", post$variable) | grepl(\"dH\", post$variable) | grepl(\"sigma_src\", post$variable)\nd1 <- post[i,]\nhead(d1)\n\nk <- grepl(\"dC\", post$variable) | grepl(\"dN\", post$variable) | grepl(\"dH\", post$variable) | grepl(\"sigma_src\", dp$variable)\ndp2 <- dp[k,]\ndp2$Labs <- NA\ndp2$Labs[dp2$variable %in%  paste0(\"dC.\", 1)] <- \"Offshore Carbon\"\ndp2$Labs[dp2$variable %in%  paste0(\"dC.\", 2)] <- \"Coastal Carbon\"\ndp2$Labs[dp2$variable %in%  paste0(\"dC.\", 3)] <- \"Freshwater Carbon\"\ndp2$Labs[dp2$variable %in%  paste0(\"dH.\", 1)] <- \"Offshore Hydrogen\"\ndp2$Labs[dp2$variable %in%  paste0(\"dH.\", 2)] <- \"Coastal Hydrogen\"\ndp2$Labs[dp2$variable %in%  paste0(\"dH.\", 3)] <- \"Freshwater Hydrogen\"\ndp2$Labs[dp2$variable %in%  paste0(\"dN.\", 1)] <- \"Offshore Nitrogen\"\ndp2$Labs[dp2$variable %in%  paste0(\"dN.\", 2)] <- \"Coastal Nitrogen\"\ndp2$Labs[dp2$variable %in%  paste0(\"dN.\", 3)] <- \"Freshwater Nitrogen\"\ndp2$Labs[dp2$variable %in%  \"sigma_src.1.1\"] <- \"Sigma Offshore Carbon\"\ndp2$Labs[dp2$variable %in%  \"sigma_src.1.2\"] <- \"Sigma Coastal Carbon\"\ndp2$Labs[dp2$variable %in%  \"sigma_src.1.3\"] <- \"Sigma Freshwater Carbon\"\ndp2$Labs[dp2$variable %in%  \"sigma_src.2.1\"] <- \"Sigma Offshore Nitrogen\"\ndp2$Labs[dp2$variable %in%  \"sigma_src.2.2\"] <- \"Sigma Coastal Nitrogen\"\ndp2$Labs[dp2$variable %in%  \"sigma_src.2.3\"] <- \"Sigma Freshwater Nitrogen\"\ndp2$Labs[dp2$variable %in%  \"sigma_src.3.1\"] <- \"Sigma Offshore Hydrogen\"\ndp2$Labs[dp2$variable %in%  \"sigma_src.3.2\"] <- \"Sigma Coastal Hydrogen\"\ndp2$Labs[dp2$variable %in%  \"sigma_src.3.3\"] <- \"Sigma Freshwater Hydrogen\"\ndp2$Labs <- factor(dp2$Labs, levels = c(\"Offshore Carbon\",\"Coastal Carbon\", \"Freshwater Carbon\", \"Offshore Nitrogen\", \"Coastal Nitrogen\", \"Freshwater Nitrogen\" , \"Offshore Hydrogen\", \"Coastal Hydrogen\", \"Freshwater Hydrogen\",\n                                        \"Sigma Offshore Carbon\",\"Sigma Coastal Carbon\", \"Sigma Freshwater Carbon\", \"Sigma Offshore Nitrogen\", \"Sigma Coastal Nitrogen\", \"Sigma Freshwater Nitrogen\" , \"Sigma Offshore Hydrogen\", \"Sigma Coastal Hydrogen\", \"Sigma Freshwater Hydrogen\"))\n\np <- ggplot(d1, aes(value)) +\n  facet_wrap(~Labs, scales = \"free\", ncol = 3) +  \n  geom_histogram(aes(y = ..density..))\n# Add the priors\np <- p + geom_line(data = dp2, aes(x = x, y = value1), color = \"red\")  +  xlab(expression(paste(\"\\nIsotope Ratio (\\u2030)\"))) + ylab(\"Probabilitiy Density\\n\")\npng(\"figs/mcmc_par_hist_source.png\", width = 8, height = 8, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"dC\", post$variable) | grepl(\"dN\", post$variable) | grepl(\"dH\", post$variable)# | grepl(\"Delta\", post$variable)\nd1 <- post[i,]\np <- ggplot(d1, aes(value)) +\n    facet_wrap(~Labs, scales = \"free\", ncol = 3) +\n    geom_histogram(aes(y = ..density..)) + ylab(\"Probability Density\\n\") + xlab(expression(paste(\"\\nIsotope Ratio (\\u2030)\")))\nj <- grepl(\"dC\", dp$variable) | grepl(\"dN\", dp$variable) | grepl(\"dH\", dp$variable)#| grepl(\"Delta\", dp$variable)\ndp1 <- dp[i,]\nhead(dp1)\ndp1$Labs <- NA\ndp1$Labs[dp1$variable %in%  paste0(\"dC.\", 1)] <- \"Offshore Carbon\"\ndp1$Labs[dp1$variable %in%  paste0(\"dC.\", 2)] <- \"Coastal Carbon\"\ndp1$Labs[dp1$variable %in%  paste0(\"dC.\", 3)] <- \"Freshwater Carbon\"\ndp1$Labs[dp1$variable %in%  paste0(\"dH.\", 1)] <- \"Offshore Hydrogen\"\ndp1$Labs[dp1$variable %in%  paste0(\"dH.\", 2)] <- \"Coastal Hydrogen\"\ndp1$Labs[dp1$variable %in%  paste0(\"dH.\", 3)] <- \"Freshwater Hydrogen\"\ndp1$Labs[dp1$variable %in%  paste0(\"dN.\", 1)] <- \"Offshore Nitrogen\"\ndp1$Labs[dp1$variable %in%  paste0(\"dN.\", 2)] <- \"Coastal Nitrogen\"\ndp1$Labs[dp1$variable %in%  paste0(\"dN.\", 3)] <- \"Freshwater Nitrogen\"\n#dp1$Labs[dp1$variable %in%  paste0(\"Delta_C\")] <- \"Delta C\"\n#dp1$Labs[dp1$variable %in%  paste0(\"Delta_N\")] <- \"Delta N\"\n#dp1$Labs[dp1$variable %in%  paste0(\"Delta_H\")] <- \"Delta H\"\n\np <- p + geom_line(data = dp1, aes(x = x, y = value1), color = \"red\")\npng(\"figs/mcmc_par_hist_source.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"Delta_C\", post$variable)\nd1 <- post[i,]\np <- ggplot(d1, aes(value)) +\n  #facet_wrap(~Labs, scales = \"free\", ncol = 3) +\n  geom_histogram(aes(y = ..density..)) + ylab(\"Probability Density\\n\") + xlab(expression(paste(\"\\nDelta C (\\u2030)\")))\nj <- grepl(\"Delta_C\", dp$variable)\ndp1 <- dp[i,]\nhead(dp1)\np <- p + geom_line(data = dp1, aes(x = x, y = value1), color = \"red\")\npng(\"figs/mcmc_par_hist_DeltaC.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"Delta_N\", post$variable)\nd1 <- post[i,]\np <- ggplot(d1, aes(value)) +\n  facet_wrap(~Labs, scales = \"free\", ncol = 3) +\n  geom_histogram(aes(y = ..density..)) + ylab(\"Probability Density\\n\") + xlab(expression(paste(\"\\nDelta N (\\u2030)\")))\nj <- grepl(\"Delta_N\", dp$variable)\ndp1 <- dp[i,]\nhead(dp1)\nfor (i in 1:M){\n  dp1$Labs[dp1$variable %in%  paste0(\"Delta_N.\", i)] <- levels(factor(dat$Taxa, ordered = TRUE))[i]\n}\np <- p + geom_line(data = dp1, aes(x = x, y = value1), color = \"red\")\npng(\"figs/mcmc_par_hist_DeltaN.png\", width = 6, height = 4, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\n\ni <- grepl(\"sigma_frc.1\", post$variable)\nd1 <- post[i,]\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- ggplot(d1, aes(value)) +\n  facet_wrap(~Species, scales = \"free\", ncol = 4) +\n  geom_histogram(aes(y = ..density..)) + xlab(expression(paste(sigma, \" Carbon Trophic Fractionation\"))) + ylab(\"Probability Density\\n\")\n# Add the priors\nj <- grepl(\"sigma_frc.1\", dp$variable)\np <- p + geom_line(data = dp[j,], aes(x = x, y = value1), color = \"red\")\npng(\"figs/mcmc_par_hist_sigma_C_frac.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"sigma_frc.2\", post$variable)\nd1 <- post[i,]\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- ggplot(d1, aes(value)) +\n  facet_wrap(~Species, scales = \"free\", ncol = 4) +\n  geom_histogram(aes(y = ..density..)) + xlab(expression(sigma~\"Nitrogen Trophic Fractionation\")) + ylab(\"Probability Density\\n\")\n# Add the priors\nj <- grepl(\"sigma_frc.2\", dp$variable)\np <- p + geom_line(data = dp[j,], aes(x = x, y = value1), color = \"red\")\npng(\"figs/mcmc_par_hist_sigma_N_frac.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"omega\", post$variable)\nd1 <- post[i,]\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- ggplot(d1, aes(x = value)) +\n  facet_wrap(~Species, scales = \"free\", ncol = 4) + xlab(\"\\nOmega\") + ylab(\"Probability Density\\n\") +\n  geom_histogram(aes(y = ..density..))\nj <- grepl(\"omega\", dp$variable)\ndp1 <- dp[j,]\ndp1$Species <- factor(dp1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- p + geom_line(data = dp1, aes(x = x, y = value1), color = \"red\")\npng(\"figs/mcmc_par_hist_omega.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"tau\", post$variable)\nd1 <- post[i,]\nd1$Species <- factor(d1$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\np <- ggplot(d1, aes(x = value)) +\n  facet_wrap(~Species, scales = \"free\", ncol = 4) + xlab(\"\\nTrophic Level\") + ylab(\"Probability Density\\n\") +\n  geom_histogram(aes(y = ..density..))\npng(\"figs/mcmc_par_hist_tau.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\ni <- grepl(\"frac_H_blki\", post$variable) | grepl(\"sigma_fblki\", post$variable)\nd1 <- post[i,]\np <- ggplot(d1, aes(x = value)) +\n  facet_wrap(~variable, scales = \"free\", ncol = 2) + ylab(\"Probability Density\\n\") + xlab(expression(paste(delta^{2}, \"H (\\u2030)\"))) +\n  geom_histogram(aes(y = ..density..))\nj <- grepl(\"frac_H_blki\", dp$variable)| grepl(\"sigma_fblki\", dp$variable)\ndp1 <- dp[j,]\np <- p + geom_line(data = dp1, aes(x = x, y = value1), color = \"red\")\npng(\"figs/mcmc_par_hist_fblki.png\", width = 6, height = 2, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\n# i <- grepl(\"DeltaC\", post$variable) | grepl(\"frac_H_blki\", post$variable)\n# d1 <- post[i,]\n# p <- ggplot(d1, aes(x = value)) +\n#   facet_wrap(~variable, scales = \"free\", ncol = 4) + xlab(expression(paste(\"\\nIsotope Ratio (\\u2030)\"))) + ylab(\"Probability Density\\n\") +\n#   geom_histogram(aes(y = ..density..))\n# j <- grepl(\"Delta\", dp$variable) | grepl(\"frac_H_blki\", dp$variable)\n# dp1 <- dp[j,]\n# p <- p + geom_line(data = dp1, aes(x = x, y = value1), color = \"red\")\n# png(\"figs/mcmc_par_hist_fractionation.png\", width = 8, height = 10, units = \"in\", res = 300)\n# plot(p)\n# dev.off()\n\n#=============================================================================#\n# Observed vs. expected\n#=============================================================================#\nlabN <- expression(paste(delta^{15}, \"N (\\u2030)\"))\nlabC <- expression(paste(delta^{13}, \"C (\\u2030)\"))\nlabH <- expression(paste(delta^{2}, \"H (\\u2030)\"))\n\ngpost$Species <- factor(gpost$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\ndat$Taxa <- factor(dat$Taxa, levels = c(\"bird liver\", \"bird blood\", \"fish\", \"YOY fish\", \"macroz\",\"microz\"))\ndat$Species <- factor(dat$Species, levels = c(\"Bulk Zoop\", \"Copepod\", \"E. pacifica\", \"Thysanoessa\", \"T. libellula\", \"Neomysis\", \"YOY Capelin\", \"YOY Herring\", \"YOY Pollock\", \"Eulachon\", \"Capelin\", \"Herring\", \"Sandlance\", \"Pollock\", \"KIMU\", \"MAMU\", \"BLKI\"))\n\n\nlibrary(scales)\ninteger_breaks <- function(n = 5, ...) {\n  breaker <- pretty_breaks(n, ...)\n  function(x) {\n    breaks <- breaker(x)\n    breaks[breaks == floor(breaks)]\n  }\n}\n\n# Posterior\np <- ggplot() +\n    stat_density2d(data = gpost, aes(x = dC, y = dH, color = factor(Species))) +\n    geom_point(data = dat, aes(x = d13C, y = d2H, color = factor(Species), shape = factor(Taxa))) + \n    xlab(labC) + ylab(labH) +\n    guides(color = guide_legend(title = \"Species\"), shape = guide_legend(title = \"Taxa\"))\npng(\"figs/fit_dC_dH.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\np <- ggplot() +  facet_wrap(~Species, scales = \"free\") +\n  geom_point(data = dat, aes(x = d13C, y = d2H, shape = Taxa)) +\n  stat_density2d(data = gpost, aes(x = dC, y = dH, fill = ..level.., alpha = ..level..), geom = \"polygon\") +\n  xlab(labC) + ylab(labH) + guides(fill = FALSE, alpha = FALSE)\npng(\"figs/fit_dC_dH_species.png\", width = 10, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\np <- ggplot() +  facet_wrap(~Species, scales = \"free\", ncol = 6) +\n  geom_point(data = dat, aes(x = d13C, y = d2H, shape = Taxa)) +\n  geom_point(data = post_pred, aes(x = dC_ppd, y = dH_ppd), color = \"#CC0000\", alpha = 0.3) +\n  stat_density2d(data = gpost, aes(x = dC, y = dH, fill = ..level.., alpha = ..level..), geom = \"polygon\") +\n  xlab(labC) + ylab(labH) + guides(color = guide_legend(title = \"Species\")) + guides(fill = FALSE, alpha = FALSE) + theme(legend.position = c(1,0), legend.justification = c(1,0), legend.text = element_text(size = 14), legend.title = element_blank()) +\n  scale_x_continuous(breaks = integer_breaks()) \npng(\"figs/fit_dC_dH_species_ppd.png\", width = 11, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\np <- ggplot() +\n    geom_density2d(data = gpost, aes(x = dC, y = dN, color = factor(Species))) +\n    geom_point(data = dat, aes(x = d13C, y = d15N, color = factor(Species), shape = Taxa)) +\n    xlab(labC) + ylab(labN) + guides(color = guide_legend(title = \"Species\"))\npng(\"figs/fit_dC_dN.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\np <- ggplot() +  facet_wrap(~Species, scales = \"free\", ncol = 6) +\n  geom_point(data = dat, aes(x = d13C, y = d15N, shape = Taxa)) +\n  geom_point(data = post_pred, aes(x = dC_ppd, y = dN_ppd), color = \"#CC0000\", alpha = 0.3) +\n  stat_density2d(data = gpost, aes(x = dC, y = dN, fill = ..level.., alpha = ..level..), geom = \"polygon\") +\n  xlab(labC) + ylab(labN) + guides(fill = FALSE, alpha = FALSE) +  theme(legend.position = c(1,0), legend.justification = c(1,0), legend.text = element_text(size = 14), legend.title = element_blank()) +\n  scale_x_continuous(breaks = integer_breaks()) \npng(\"figs/fit_dC_dN_species_ppd.png\", width = 10, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\np <- ggplot() +\n  geom_point(data = dat, aes(x = d13C, y = d15N, shape = Taxa)) +\n  stat_density2d(data = gpost, aes(x = dC, y = dN, fill = ..level.., alpha = ..level..), geom = \"polygon\") +\n  xlab(labC) + ylab(labN)  + facet_wrap(~Species, scales = \"free\") + guides(fill = FALSE, alpha = FALSE)\npng(\"figs/fit_dC_dN_species.png\", width = 10, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\np <- ggplot() +  facet_wrap(~Species, scales = \"free\") +\n  geom_point(data = dat, aes(x = d15N, y = d2H, shape = Taxa)) +\n  geom_point(data = post_pred, aes(x = dN_ppd, y = dH_ppd), color = \"#CC0000\", alpha = 0.3) +\n  stat_density2d(data = gpost, aes(x = dN, y = dH, fill = ..level.., alpha = ..level..), geom = \"polygon\") +\n  xlab(labN) + ylab(labH) + guides(fill = FALSE, alpha = FALSE)\npng(\"figs/fit_dN_dH_species_ppd.png\", width = 10, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\np <- ggplot() +\n    geom_density2d(data = gpost, aes(x = dN, y = dH, color = factor(Species))) +\n    geom_point(data = dat, aes(x = d15N, y = d2H, color = factor(Species), shape = Taxa)) +\n    xlab(labN) + ylab(labH) + guides(color = guide_legend(title = \"Species\"))\npng(\"figs/fit_dN_dH.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\np <- ggplot() +\n  geom_point(data = dat, aes(x = d15N, y = d2H, shape = Taxa)) +\n  stat_density2d(data = gpost, aes(x = dN, y = dH, fill = ..level.., alpha = ..level..), geom = \"polygon\") +\n  #geom_density2d(data = gpost, aes(x = dN, y = dH, color = factor(Species))) +\n  xlab(labN) + ylab(labH) + facet_wrap(~Species, scales = \"free\") + guides(fill = FALSE, alpha = FALSE)\npng(\"figs/fit_dN_dH_species.png\", width = 10, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\n#=============================================================================#\n# Isotope mixing space plots\n#=============================================================================#\n\np <- ggplot() + \n  stat_density2d(data = spost, aes(x = dC, y = dH, fill = Source, color = Source, geom = \"polygon\")) + \n  scale_color_manual(values = cpal) + guides(shape = FALSE) + theme(legend.position = c(1,0),  legend.justification = c(1,0.2)) +\n  geom_point(data = dat, aes(x = d13C, y = dH_adj_postmean, shape = Taxa)) +  facet_wrap(~ Species, scales = \"free\", ncol = 6) + xlab(labC) + ylab(expression(paste(delta^{2},H[diet]~'(\\u2030)')))  +\n  scale_x_continuous(breaks = integer_breaks())\n  \npng(\"figs/fit_dC_dH_src.png\", width = 10, height = 5, units = \"in\", res = 300)\nplot(p)\ndev.off()  \n\np <- ggplot() + \n  stat_density2d(data = spost, aes(x = dN, y = dH, fill = Source, color = Source, geom = \"polygon\")) +\n  scale_color_manual(values = cpal) +\n  geom_point(data = dat, aes(x = d15N, y = dH_adj_postmean, shape = Taxa)) +\n  xlab(labN) + ylab(expression(paste(delta^{2},H[diet]~'(\\u2030)'))) + facet_wrap(~Species, scales = \"free\") \npng(\"figs/fit_dN_dH_src.png\", width = 9.5, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off() \n\np <- ggplot() + \n  stat_density2d(data = spost, aes(x = dC, y = dN, fill = Source, color = Source, geom = \"polygon\")) +\n  scale_color_manual(values = cpal) +\n  geom_point(data = dat, aes(x = d13C, y = d15N, shape = Taxa)) +\n  xlab(labC) + ylab(labN) + facet_wrap(~Species, ncol = 4, scales = \"free\") \npng(\"figs/fit_dC_dN_src.png\", width =9.5, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\n#########################################################################################################\n# is there a trend in d2H_adjust relative to dN? If yes, then omega_j is not correct\n# no need for any posteriors in this plot\n#########################################################################################################\np <- ggplot() + \n  geom_point(data = dat, aes(x = d15N, y = dH_adj_postmean, color = factor(Species), shape = Taxa)) +\n  xlab(labN) + ylab(expression(paste(delta^{2},H[diet]~'(\\u2030)'))) + guides(color = guide_legend(title = \"Species\"))\npng(\"figs/fit_dHdiet_dN.png\", width = 8, height = 6, units = \"in\", res = 300)\nplot(p)\ndev.off()\n\n#p <- ggplot() +\n#    geom_density2d(data = gpost, aes(x = dC, y = dH)) +\n#    geom_point(data = dat, aes(x = d13C, y = d2H, shape = factor(year), color = factor(fjord))) + \n#    xlab(labC) + ylab(labH) +\n#    facet_wrap(~Species) + \n#    guides(color = guide_legend(title = \"Fjord\"),\n#           shape = guide_legend(title = \"Year\"))\n\n#png(\"figs/fit_dC_dH_v2.png\", width = 8, height = 6, units = \"in\", res = 300)\n#plot(p)\n#dev.off()\n\n\n#p <- ggplot() +\n#    geom_density2d(data = gpost, aes(x = dN, y = dH)) +\n#    geom_point(data = dat, aes(x = d15N, y = d2H, shape = factor(year), color = factor(fjord))) + \n#    xlab(labN) + ylab(labH) +\n#    facet_wrap(~Species) + \n#    guides(color = guide_legend(title = \"Fjord\"),\n#           shape = guide_legend(title = \"Year\"))\n\n#png(\"figs/fit_dN_dH_v2.png\", width = 8, height = 6, units = \"in\", res = 300)\n#plot(p)\n#dev.off()\n\n#=============================================================================#\n\n",
    "created" : 1450079819544.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "324131040",
    "id" : "3AE09C3A",
    "lastKnownWriteTime" : 1450079769,
    "path" : "~/GitHub/H-C-N-isotope/Plot.R",
    "project_path" : "Plot.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}